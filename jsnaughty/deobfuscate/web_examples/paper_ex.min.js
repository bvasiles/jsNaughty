module.exports = http.createServer(function(e, r) {
    var t;
    var n = new stream.Stream();
    n.writeable = true;
    n.readable = true;
    n.pipe(r);
    var o = "";
    csv().fromStream(e).on("data", function(e, r) {
        if (!t) {
            n.emit("data", '{"docs":[');
            t = e;
            return;
        }
        var a = {};
        _(_.zip(t, e)).each(function(e) {
            a[_.first(e)] = _.last(e);
        });
        n.emit("data", o + JSON.stringify(a));
        o = ",";
    }).on("end", function(e) {
        n.emit("data", "]}");
        n.emit("end");
    }).on("error", function(e) {
        n.emit("error", e);
        console.log("csv error", e.message);
    });
});
